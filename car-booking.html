<!DOCTYPE html>
<html lang="en"> 
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Taxi solidale</title>
  <link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css">  
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

</head>
<body>
  

  <header>
    <div class="logo">
      <img src="img/logo-cuore-colorato.jpg" alt="Logo Cuore Colorato, progetto taxi solidale">
      <span>Taxi Solidale</span>
    </div>
    <nav>
      <a href="/prenotazioni">Prenotazioni</a>
      <a href="/auto">Auto</a>
      <a href="/login">Login</a>
    </nav>
  </header>

  <!-- Lista prenotazioni -->
  <table id="carsBookingTable">
      <thead>
          <tr>
              <th>ID Prenotazione</th>
              <th>Modello</th>
              <th>Nome Cliente</th>
              <th>Data Prenotazione</th>
              <th>Stato</th>
              <th>Azioni</th>
              <th>Azioni</th>
          </tr>
      </thead>
      <tbody>
        <!-- Le righe verranno inserite dinamicamente tramite JavaScript -->
      </tbody>
    </table>  

    <!-- Dettaglio prenotazione (modal) -->
    <div class="modal" id="details-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Dettagli Prenotazione</h2>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <p><strong>ID:</strong> <span id="modal-id"></span></p>
          <p><strong>Targa:</strong> <span id="modal-plate"></span></p>
          <p><strong>Modello:</strong> <span id="modal-model"></span></p>
          <p><strong>Data:</strong> <span id="modal-date"></span></p>
          <p><strong>Stato:</strong> <span id="modal-status"></span></p>
        </div>
      </div>
    </div>
  
</body>
</html>



<script>
    const API_URL = 'https://server-node-igna.vercel.app/carsRental';

    // Funzione per ottenere e visualizzare le prenotazioni
    async function getBookings() {
      try {
        const response = await fetch(API_URL);
        const bookings = await response.json();

        const tbody = document.querySelector('#carsBookingTable tbody');
        tbody.innerHTML = ''; // Svuota la tabella

        bookings.forEach(booking => {
          const row = document.createElement('tr');
          console.log(booking);
          
          // Imposta la classe di stato per colorare la cella in base allo stato
          let statusClass = '';
          switch (booking.status) {
            case 'booked':
              statusClass = 'status-booked'; 
              break;
            case 'active':
              statusClass = 'status-active'; 
              break;
            case 'completed':
              statusClass = 'status-completed';
              break;
            case 'cancelled':
              statusClass = 'status-cancelled';
              break;
            default:
              statusClass = '';
          }

          row.innerHTML = `
            <td class="small">${booking._id}</td>
            <td>${booking.carId.model}</td>
            <td>${booking.user}</td>
            <td>${new Date(booking.startTime).toLocaleDateString()}</td>
            <td class="${statusClass}">${booking.status}</td>
            <td class="actions">
              <button class="button-7" data-booking='${JSON.stringify(booking)}' onclick="viewBooking(this)">Visualizza</button>
              <button class="button-8" onclick="cancelBooking('${booking._id}')">Annulla</button>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-details" title="Details">
                  <i class="fas fa-info-circle"></i>
                </button>
                <button class="btn btn-update" title="Update">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-delete" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          `;

          tbody.appendChild(row);
        });
      } catch (error) {
        console.error("Errore nel recupero delle prenotazioni:", error);
      }
    }

    // Richiama la funzione per caricare le prenotazioni quando la pagina viene caricata
    window.onload = getBookings;
</script> 


<script>
  // Funzione per mostrare il modal con i dettagli
  function viewBooking(button) {
    const booking = JSON.parse(button.getAttribute('data-booking'));
    console.log(booking);  
    const formattedStartTime = new Date(booking.startTime).toLocaleDateString();
    console.log("Data di inizio:", formattedStartTime);
    
    document.getElementById('modal-id').textContent = booking._id;
    document.getElementById('modal-plate').textContent = booking.carId.plate;
    document.getElementById('modal-model').textContent = booking.carId.model;
    document.getElementById('modal-date').textContent = formattedStartTime;
    document.getElementById('modal-status').textContent = booking.status;

    const modal = document.getElementById('details-modal');
    modal.style.display = 'flex';
  }

    // Funzione per chiudere il modal
    function closeModal() {
      const modal = document.getElementById('details-modal');
      modal.style.display = 'none';
    }
</script>
